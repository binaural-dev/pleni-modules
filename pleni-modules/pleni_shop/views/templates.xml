<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <!-- Impromevents of shop -->
	<template id="website_product_unity" inherit_id="website_sale.products_item">
    <xpath expr="//form/div[2]/div[1]/div[1]/span[1]" position="after">
			<span> / </span>
      <span t-esc="combination_info['uom_id']"></span>
    </xpath>

    <xpath expr="//div[hasclass('product_price')]" position="replace">
      <div class="product_price" itemprop="offers" itemscope="itemscope" itemtype="http://schema.org/Offer" >
        <del t-attf-class="text-danger mr-2 {{'' if combination_info['has_discounted_price'] else 'd-none'}}" style="white-space: nowrap; font-size: small;" t-esc="combination_info['list_price']" t-options="{'widget': 'monetary', 'display_currency': website.currency_id}"/>
        <t t-if="not combination_info['wholesale_price']">
          <span t-if="combination_info['price']" t-esc="combination_info['price']" t-options="{'widget': 'monetary', 'display_currency': website.currency_id}"/>
          <span itemprop="price" style="display:none;" t-esc="combination_info['price']" />
          <span itemprop="priceCurrency" style="display:none;" t-esc="website.currency_id.name" />
          <span style="font-size: 10px;"> / </span>
          <span style="font-size: 10px;" t-esc="combination_info['uom_id']"/>
          <br/>
          <br/>
        </t>
        <t t-else="">
            <div style="white-space: nowrap; text-overflow: ellipsis; overflow: hidden;">
              <div class="badge badge-danger">
                <span t-if="combination_info['discount_rate']" t-esc="combination_info['discount_rate']" style="font-size: 10px;"/>
                <span style="font-size: 10px;">%</span>
              </div>
              <span style="white-space: nowrap;">
                <span t-if="combination_info['price']" t-esc="combination_info['price']" t-options="{'widget': 'monetary', 'display_currency': website.currency_id}" style="text-decoration:line-through; font-size: 10px;"/>
                <span itemprop="price" style="display:none; text-decoration:line-through;" t-esc="combination_info['price']" />
                <span itemprop="priceCurrency" style="display:none; text-decoration:line-through;" t-esc="website.currency_id.name" />
                <span style="text-decoration:line-through; font-size: 10px;">/</span>
                <span style="text-decoration:line-through; font-size: 10px;" t-esc="combination_info['uom_id']"></span>
              </span>
            </div>
          </t>
      </div>
    </xpath>

    <xpath expr="//div[hasclass('product_price')]" position="before">
        <t t-set="combination_info" t-value="product._get_combination_info(combination, add_qty=add_qty or 1, pricelist=website_sale_order.pricelist_id)"/>
        <div t-if="combination_info['wholesale_price']" class="product_price" itemprop="offers" itemscope="itemscope" itemtype="http://schema.org/Offer">
          <del t-attf-class="text-danger mr-2 {{'' if combination_info['has_discounted_price'] else 'd-none'}}" style="white-space: nowrap;" t-esc="combination_info['list_price']" t-options="{'widget': 'monetary', 'display_currency': website.currency_id}" />
          <span t-if="combination_info['wholesale_price']" class="item-price-shop" t-esc="combination_info['wholesale_price']" t-options="{'widget': 'monetary', 'display_currency': website.currency_id}"/>
          <span itemprop="price" style="display:none; font-size: 12px" t-esc="combination_info['wholesale_price']" />
          <span itemprop="priceCurrency" style="display:none" t-esc="website.currency_id.name" />
          <span  style="font-size: 10px; color: #E85C2E; font-weight: bold"> / </span>
          <span t-esc="combination_info['uom_id']" class="item-uom-shop"></span>
        </div>
        <style>
          @media (min-width: 980px) {
            .item-price-shop {
                font-size: 1.2em; 
                color: #E85C2E; 
                font-weight: bold
            }

            .item-uom-shop {
                font-size: 0.9em; 
                color: #E85C2E; 
                font-weight: bold
            }
          }

          @media (max-width: 980px) {
            .item-price-shop {
                font-size: 1em; 
                color: #E85C2E; 
                font-weight: bold
            }

            .item-uom-shop {
                font-size: 0.9em; 
                color: #E85C2E; 
                font-weight: bold
            }
          }
      </style>
    </xpath> 
  </template>
  <template id="as_shop_product_label_height" inherit_id="website_sale.products_item">
      <xpath expr="//div[hasclass('oe_product_image')]" position="before">
          <style>
              .o_wsale_products_grid_table_wrapper .oe_product .oe_product_image a span img{
                  height: 13vh !important;
              }

              .o_wsale_products_grid_table_wrapper .oe_product .o_wsale_products_item_title a {
                  width: 100%
              }
          </style>
      </xpath>
  </template>
  <template id="o_quick_view_title_style" inherit_id="website_sale.products_item">
      <xpath expr="//h6[hasclass('o_wsale_products_item_title')]/a[1]" position="replace">
          <a itemprop="name" t-att-href="product_href" t-att-content="product.name" t-field="product.name" 
              class="o_quick_view_title" t-att-data-product-product-id="product.product_variant_ids[0].id" 
              t-att-data-product_template_id="product.id" t-att-title="product.name" type="button" href=""/>
      </xpath>
      <xpath expr="//h6[hasclass('o_wsale_products_item_title')]/a[1]" position="after">
          <script type="text/javascript">
              document.querySelectorAll('.o_quick_view_title').forEach(function(element) {
                  element.removeAttribute("href")
                  element.text = element.text.substring(0,30);
                  if (element.text.length === 30) {
                      if (element.text.slice(-1) !== ' ') {
                          element.text = element.text + '...'
                      }
                  }  
              });
          </script>
      </xpath>
    </template>

    <template id="login_msg_view" inherit_id="website_sale.add_grid_or_list_option">
      <xpath expr="//div[hasclass('products_pager')]" position="before">
        <t t-if="request.env.user.id == request.env.ref('base.public_user').id">
          <div class="alert alert-success text-left mt16" role="alert">
            Para continuar con la experiencia de comprar en Pleni,
            <a t-attf-href="/web/login?{{ keep_query() }}" class="alert-link" id="alert-login">
              inicia sesión
            </a>
          </div>
        </t>

        <t t-if="request.env.user.id != request.env.ref('base.public_user').id">
          <t t-if="request.env.user.partner_id.get_count_wish_products()">
            <div class="alert alert-success text-left mt16" role="alert">
              ¿Siempre compras los mismos productos? Agrégalos a tu lista de Compra Frecuente, dándole click al botón de corazón
            </div>
          </t>
        </t>
      </xpath>
    </template>

    <template id="3mit_website_products_categories_inherit" inherit_id="website_sale.products_categories">
      <xpath expr="//div[@id='wsale_products_categories_collapse']/ul[1]/li[1]" position="replace">
        <li class="nav-item d-flex">
          <a t-att-href="keep('/shop', category=0)" t-attf-class="nav-link #{'' if category else 'active'} o_not_editable" style="flex: 1; z-index: 1;">
            <span style="width: 100%; white-space: nowrap;">Todos los productos</span>
          </a>
        </li>
      </xpath>
    </template>

    <template id="3mit_website_option_collapse_categories_recursive_inherit" inherit_id="website_sale.option_collapse_categories_recursive">
      <xpath expr="." position="replace">
        <li class="nav-item d-flex flex-column pl-0 text-nowrap">
          <t t-set="children" t-value="not search and c.child_id or c.child_id.filtered(lambda c: c.id in search_categories_ids)"/>
          <i t-if="children" t-attf-class="text-primary fa #{'fa-chevron-down' if c.id in category.parents_and_self.ids else 'fa-chevron-right'}"
              t-attf-title="#{'Unfold' if c.id in category.parents_and_self.ids else 'Fold'}"
              t-attf-aria-label="#{'Unfold' if c.id in category.parents_and_self.ids else 'Fold'}" role="img"/>
          <a t-att-href="keep('/shop/category/' + slug(c), category=0)" t-attf-class="nav-link #{'active' if c.id == category.id else ''}" style="flex: 1; z-index: 1;">
              <span t-field="c.name" style="width: 100%; white-space: nowrap;"/>
          </a>
          <ul t-if="children" class="nav nav-pills flex-column nav-hierarchy" t-att-style="'display:flex; flex-direction: column; ' if c.id in category.parents_and_self.ids else 'display:none;'">
              <t t-foreach="children" t-as="c">
                  <t t-call="website_sale.option_collapse_categories_recursive"/>
              </t>
          </ul>
        </li>
      </xpath>
    </template>

    <template id="add_qty_input_inherit" inherit_id="website_sale.product_quantity">
      <xpath expr="//input[@name='add_qty']" position="replace">
			  <input type="text" class="form-control quantity" 
          data-min="0" name="add_qty" t-att-value="'0.00'" disabled="disabled"/>
      </xpath>
    </template>

    <template id="pricelist_hidden_input" inherit_id="website_sale.product">
        <xpath expr="//input[@name='product_template_id']" position="after">
          <input type="hidden" class="pricelist" name="pricelist" t-att-value="pricelist.id" />
        </xpath>
        <xpath expr="//a[@id='add_to_cart']" position="replace">
          <a role="button" id="add_to_cart" 
            class="btn btn-primary btn-lg mt16 js_check_product a-submit d-block d-sm-inline-block" 
            href="#"><i class="fa fa-shopping-cart"/> 
            Agregar $0.00
          </a>
        </xpath>
    </template>

    <template id="product_price_has_discount" inherit_id="website_sale.product_price">
      <xpath expr="//h4[1]/span[1]" position="replace">
			  <span t-attf-class="text-danger oe_default_price {{'' if (combination_info['has_discounted_price'] or combination_info['show_discount']) else 'd-none'}}" style="text-decoration: line-through; white-space: nowrap;"
          t-esc="combination_info['list_price']" 
          t-options="{'widget': 'monetary', 'display_currency': website.currency_id}"
        />
      </xpath>
    </template>

    <template id="pricelist_view_by_city">
      <table>
        <tr>
          <th>Producto</th>
          <th>Precio -  A partir de </th>
        </tr>
        <t t-foreach="pricelist" t-as="product">
            <tr>
              <td><t t-esc="product['name']"/></td>
              <td>
                <t t-if="'detail' in product">
                  <t t-set="count" t-value="0"/>
                  <t t-set="array_length" t-value="len(product['detail'])"/>
                  <t t-foreach="product['detail']" t-as="price">
                    <t t-set="count" t-value="count+1"/>
                    $ <t t-esc="price['price']"/>
                    <t t-esc="price['uom']"/>
                    <t t-if="array_length > count">
                      /
                    </t>
                  </t>
                </t>
              </td>
            </tr>
          </t>
      </table>
      <style>
        table {
          font-family: arial, sans-serif;
          border-collapse: collapse;
          width: 90%;
          margin: 0 auto;
        }

        td, th {
          border: 1px solid #dddddd;
          text-align: left;
          padding: 8px;
        }

        tr:nth-child(even) {
          background-color: #dddddd;
        }
      </style>
    </template>

    <template id="processing_payment">
      <t t-call="website.layout">
        <t t-set="additional_title">Tienda - Pago</t>
        <div id="wrap">
            <div class="container oe_website_sale py-2">
                <div class="alert alert-success" role="alert">
                  Un miembro de nuestro equipo se pondrá en contacto con usted para confirmar su pedido.
                </div>
                <h1>
                  <span>Pedido</span> 
                  <em t-field="order.name" /> 
                </h1>

                <div class="row">
                    <div class="col-12 col-xl">
                        <div class="oe_cart">
                            <div class="oe_structure clearfix mt-3" id="oe_structure_website_sale_confirmation_1"/>
                            <h3 class="text-left mt-3">
                                <strong>Información del Pago:</strong>
                            </h3>
                            <table class="table">
                                <tbody>
                                    <tr>
                                        <td colspan="2">
                                          <span class="text-success font-weight-bold"> 
                                            <i class="fa fa-fw fa-check-circle"/> Método de pago: 
                                          </span>
                                          <span class="font-weight-bold">
                                            <t t-foreach="order.payment_methods" t-as="method">
                                              <t t-esc="method.name" />
                                            </t>
                                          </span>
                                        </td>
                                        <td colspan="2">
                                          <span class="font-weight-bold"> 
                                            <i class="fa fa-credit-card"/> Status de pago: 
                                          </span>
                                          <span class="font-weight-bold">
                                            <t t-if="order.payment_state == False">
                                              <span class="text-danger">Sin pago encontrado</span>
                                            </t>
                                            <t t-else="">

                                              <t t-if="order.payment_state == 'verified'">
                                                <span class="text-success">Verificado</span>
                                              </t>

                                              <t t-if="order.payment_state == 'partial'">
                                                <span class="text-warning">Verificación En proceso</span>
                                              </t>

                                              <t t-if="order.payment_state == 'pending'">
                                                <span class="text-warning">Por verificar</span>
                                              </t>
                                            </t>

                                          </span>
                                        </td>
                                        <td class="text-right" width="100">
                                            <strong>Total:</strong>
                                        </td>
                                        <td class="text-right" width="100">
                                            <strong t-field="order.amount_total" 
                                              t-options="{'widget': 'monetary', 'display_currency': order.pricelist_id.currency_id}" />
                                            <strong>
                                              <div>
                                                <span id="exchange-bs">
                                                Bs. <t t-esc="round(order.amount_total * order.currency_rate, 2)" />
                                                </span>
                                              </div>
                                            </strong>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <div class="card mt-3">
                              <div class="card-body">
                                <t t-set="same_shipping" t-value="bool(order.partner_shipping_id==order.partner_id or only_services)" />
                                <div><b>Facturación <t t-if="same_shipping and not only_services"> &amp; Envío</t>: </b><span t-esc='order.partner_id' t-options="dict(widget='contact', fields=['address'], no_marker=True, separator=', ')" class="address-inline"/></div>
                                <div t-if="not same_shipping and not only_services" groups="sale.group_delivery_invoice_address"><b>Envío: </b><span t-esc='order.partner_shipping_id' t-options="dict(widget='contact', fields=['address'], no_marker=True, separator=', ')"  class="address-inline"/></div>
                              </div>
                            </div>
                            <div class="oe_structure mt-3" id="oe_structure_website_sale_confirmation_2"/>
                        </div>
                    </div>
                </div>
            </div>
            <div class="oe_structure" id="oe_structure_website_sale_confirmation_3"/>
            <div class="clearfix text-center" id="back_button">
              <button class="btn btn-primary as-btn mt-4 text-center">
                  Regresar al Inicio
              </button>
            </div>
        </div>
      </t>
      <script type="text/javascript">
        document.getElementById("back_button").onclick = function() {  
          let url =  location.protocol + '//' + location.host;
          window.location.replace(url);
        };
      </script>
    </template>
</odoo>
